webpackJsonp([13],{463:function(t,e,o){"use strict";function a(t){o(679)}Object.defineProperty(e,"__esModule",{value:!0});var s=o(565),i=o.n(s);for(var n in s)"default"!==n&&function(t){o.d(e,t,function(){return s[t]})}(n);var r=o(685),l=o(18),u=a,p=l(i.a,r.a,!1,u,null,null);e.default=p.exports},565:function(t,e,o){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=o(7),i=a(s),n=o(8),r=a(n),l=o(12),u=a(l),p=o(21),c=o(183),d=a(c),m=o(9),f=a(m),_=o(86),x=a(_),b=o(681),g=a(b);e.default={name:"user-photo",asyncData:function(t){var e=t.store,o=t.route;return e.dispatch("photos/getPhoto",{user_id:o.params.id,photo_id:o.params.photo})},components:{ModalLayout:x.default,CommentsBlock:g.default},data:function(){return{edit:!1,editText:""}},computed:(0,u.default)({},(0,p.mapState)("profile",["user_profile"]),(0,p.mapState)("user",["user"]),(0,p.mapState)("photos",["photo"])),methods:(0,u.default)({},(0,p.mapMutations)("photos",["CHANGE_PHOTO"]),{saveAbout:function(){var t=this;return(0,r.default)(i.default.mark(function e(){var o,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o={about:t.editText},e.prev=1,e.next=4,f.default.put("/api/v1/photo",{user_id:t.user.user_id,photo_id:t.$route.params.photo,data:o},{headers:{Authorization:"Bearer "+t.user.token}});case 4:a=e.sent,a.data.success&&t.CHANGE_PHOTO({single:{about:t.editText}}),t.edit=!1,t.editText="",e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.log(e.t0);case 13:case"end":return e.stop()}},e,t,[[1,10]])}))()},close:function(){window.history.length<=2?this.$router.push("/user/"+this.$route.params.id):window.sessionStorage?this.$router.push(sessionStorage.getItem("prevUrl")):this.$router.push("/user/"+this.$route.params.id)},returnDate:function(t){var e=new Date(t),o=e.getDate();o=o<10?"0"+o:o;var a=e.getMonth()+1;return a=a<10?"0"+a:a,o+"."+a+"."+e.getFullYear()},returnAva:function(){return d.default.returnAvatarMini(this.user_profile.gender,this.user_profile.src,this.user_profile.image)}})}},566:function(t,e,o){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=o(7),i=a(s),n=o(8),r=a(n),l=o(12),u=a(l),p=o(21),c=o(183),d=a(c),m=o(9),f=a(m);e.default={props:["comments","photoId"],data:function(){return{message:""}},computed:(0,u.default)({},(0,p.mapState)("user",["user"])),sockets:{addPhotoComment:function(t){this.ADD_PHOTO_COMMENT(t)}},methods:(0,u.default)({},(0,p.mapMutations)("photos",["CHANGE_PHOTO","ADD_PHOTO_COMMENT"]),{returnAvatar:function(t,e,o){return d.default.returnAvatarMini(t,e,o)},returnDate:function(t){var e=new Date(t),o=e.getDate();o=o<10?"0"+o:o;var a=e.getMonth()+1;a=a<10?"0"+a:a;var s=e.getFullYear(),i=e.getHours();i=i<10?"0"+i:i;var n=e.getMinutes();return n=n<10?"0"+n:n,o+"."+a+"."+s+" "+i+":"+n},send:function(){var t=this;return(0,r.default)(i.default.mark(function e(){var o,a,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.user.auth){e.next=13;break}return o=new Date,a={date_created:o,comment:t.message,user:{id:t.user.user_id,firstname:t.user.profile.firstname,lastname:t.user.profile.lastname,gender:t.user.profile.gender,user_info:{src:t.user.profile.user_info.src,image:t.user.profile.user_info.image}}},e.prev=3,e.next=6,f.default.post("/api/v1/photo-comments",{user_id:t.user.user_id,photo_id:t.photoId,message:t.message,data:a},{headers:{Authorization:"Bearer "+t.user.token}});case 6:s=e.sent,t.message="",e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.log(e.t0);case 13:case"end":return e.stop()}},e,t,[[3,10]])}))()}})}},679:function(t,e,o){var a=o(680);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);o(455)("58b2e4fe",a,!0,{})},680:function(t,e,o){e=t.exports=o(454)(!1),e.push([t.i,".photo-page{max-width:970px;min-width:970px}.photo-page__img{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;min-height:300px}.photo-page__img,.photo-page__img .image{border-radius:5px 5px 0 0}.photo-page__about{width:100%;padding:35px 70px 35px 30px}.photo-page__about .user-info{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:20px}.photo-page__about .user-info .image{width:40px;height:40px;border-radius:50%}.photo-page__about .user-info__block{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start;margin-left:10px}.photo-page__about .user-info__block-name{margin-bottom:5px;color:#000}.photo-page__about .user-info__block-date{font-size:.75rem;color:#9e9e9e}.photo-page__about .about-info{width:100%;position:relative}.photo-page__about .about-info__text{line-height:25px;color:#000}.photo-page__about .about-info__text .description{font-family:Ubuntu,sans-serif;font-size:.85rem;font-style:italic;color:#b3b3b3}.photo-page__about .about-info__edit{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.photo-page__about .about-info__edit-textarea{width:100%;padding:10px 15px;border-radius:5px;-webkit-box-shadow:0 5px 8px 2px rgba(0,4,7,.03);box-shadow:0 5px 8px 2px rgba(0,4,7,.03);border:1px solid #e9e9e9;color:#000;margin-bottom:20px;-webkit-transition:all .3s;transition:all .3s;resize:none}.photo-page__about .about-info__edit-textarea:focus{border:1px solid #000}.photo-page__about .about-info__edit-btns{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.photo-page__about .about-info__edit-btns .btn{margin-left:30px}.photo-page__about .about-info .edit{position:absolute;top:0;right:-30px}.photo-page__comments-list{background:#f9f9f9;width:100%;padding:10px 30px;border-top:1px solid #eee;border-bottom:1px solid #eee}.photo-page__comments-list .commentsItem{width:100%;border-bottom:1px solid #eee;padding:20px 0;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.photo-page__comments-list .commentsItem-avatar{margin-right:10px;-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto}.photo-page__comments-list .commentsItem-avatar .image{width:40px;height:40px;border-radius:50%}.photo-page__comments-list .commentsItem-comment{width:100%;-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto;padding-top:5px}.photo-page__comments-list .commentsItem-comment__name{font-size:.75rem;color:#b3b3b3;margin-bottom:5px}.photo-page__comments-list .commentsItem-comment__name .date{margin-left:30px}.photo-page__comments-list .commentsItem-comment__text{width:100%;color:#000}.photo-page__comments-list .commentsItem:last-child{border-bottom:none}.photo-page__comments-form{width:100%;padding:35px 100px 20px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.photo-page__comments-form .inpt{width:100%;padding:10px 15px;border-radius:5px;-webkit-box-shadow:0 5px 8px 2px rgba(0,4,7,.03);box-shadow:0 5px 8px 2px rgba(0,4,7,.03);border:1px solid #e9e9e9;color:#000;font-size:.85rem;-webkit-transition:all .3s;transition:all .3s}.photo-page__comments-form .inpt:focus{border:1px solid #000}.photo-page__comments-form .btn{-webkit-box-flex:1;-ms-flex:1 0 auto;flex:1 0 auto;margin-left:30px}",""])},681:function(t,e,o){"use strict";function a(t){o(682)}Object.defineProperty(e,"__esModule",{value:!0});var s=o(566),i=o.n(s);for(var n in s)"default"!==n&&function(t){o.d(e,t,function(){return s[t]})}(n);var r=o(684),l=o(18),u=a,p=l(i.a,r.a,!1,u,null,null);e.default=p.exports},682:function(t,e,o){var a=o(683);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);o(455)("d45cc16c",a,!0,{})},683:function(t,e,o){e=t.exports=o(454)(!1),e.push([t.i,"",""])},684:function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"photo-page__comments"},[t.comments.length>0?o("div",{staticClass:"photo-page__comments-list"},t._l(t.comments,function(e,a){return o("div",{key:a,staticClass:"commentsItem"},[o("div",{staticClass:"commentsItem-avatar"},[o("img",{staticClass:"image",attrs:{src:t.returnAvatar(e.user.gender,e.user.user_info.src,e.user.user_info.image)}})]),o("div",{staticClass:"commentsItem-comment"},[o("div",{staticClass:"commentsItem-comment__name"},[t._v("\n          "+t._s(e.user.firstname)+" "+t._s(e.user.lastname)+"\n          "),o("span",{staticClass:"date"},[t._v("\n            "+t._s(t.returnDate(e.date_created))+"\n          ")])]),o("div",{staticClass:"commentsItem-comment__text"},[t._v("\n          "+t._s(e.comment)+"\n        ")])])])}),0):t._e(),t.user.auth?o("div",{staticClass:"photo-page__comments-form"},[o("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.message,expression:"message",modifiers:{trim:!0}}],staticClass:"inpt",attrs:{type:"text",placeholder:"Оставить комментарий"},domProps:{value:t.message},on:{input:function(e){e.target.composing||(t.message=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),o("button",{staticClass:"btn",on:{click:function(e){return t.send()}}},[o("img",{attrs:{src:"/img/icons/send.png"}})])]):t._e()])},s=[],i={render:a,staticRenderFns:s};e.a=i},685:function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return t.photo?o("div",[o("modal-layout",{attrs:{bgShow:!0,modalShow:!0},on:{close:function(e){return t.close()}}},[o("div",{staticClass:"modalBlock photo-page no-pad"},[o("div",{staticClass:"photo-page__img"},[o("img",{staticClass:"image",attrs:{src:"/api/"+t.photo.single.src+"/"+t.photo.single.image}})]),o("div",{staticClass:"photo-page__about"},[o("div",{staticClass:"user-info"},[o("img",{staticClass:"image",attrs:{src:t.returnAva()}}),o("div",{staticClass:"user-info__block"},[o("div",{staticClass:"user-info__block-name"},[t._v("\n              "+t._s(t.user_profile.firstname)+" "+t._s(t.user_profile.lastname)+"\n            ")]),o("div",{staticClass:"user-info__block-date"},[t._v("\n              "+t._s(t.returnDate(t.photo.single.date_created))+"\n            ")])])]),o("div",{staticClass:"about-info"},[t.edit?o("div",{staticClass:"about-info__edit"},[o("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.editText,expression:"editText",modifiers:{trim:!0}}],staticClass:"about-info__edit-textarea",attrs:{col:"3"},domProps:{value:t.editText},on:{input:function(e){e.target.composing||(t.editText=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}}),o("div",{staticClass:"about-info__edit-btns"},[o("button",{staticClass:"btn addNew",on:{click:function(e){t.edit=!1,t.editText=""}}},[t._v("\n                Отмена\n              ")]),o("button",{staticClass:"btn send",on:{click:function(e){return t.saveAbout()}}},[t._v("\n                Сохранить\n              ")])])]):o("div",{staticClass:"about-info__text"},[t.photo.single.about?o("div",[t._v("\n              "+t._s(t.photo.single.about)+"\n            ")]):t.user&&t.user.user_id==t.user_profile.id?o("div",{staticClass:"description"},[t._v("\n              Здесь будет описание к фото\n            ")]):t._e()]),t.edit||t.user_profile.id!=t.user.user_id?t._e():o("a",{staticClass:"edit",attrs:{href:"/edit",title:"Редактировать описание"},on:{click:function(e){e.preventDefault(),t.edit=!0,t.editText=t.photo.about}}},[o("img",{attrs:{src:"/img/icons/edit.png"}})])])]),o("comments-block",{attrs:{comments:t.photo.comments,photoId:t.$route.params.photo}})],1)])],1):t._e()},s=[],i={render:a,staticRenderFns:s};e.a=i}});