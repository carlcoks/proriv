webpackJsonp([3],{447:function(t,e,s){"use strict";function a(t){s(573)}Object.defineProperty(e,"__esModule",{value:!0});var i=s(483),r=s.n(i);for(var n in i)"default"!==n&&function(t){s.d(e,t,function(){return i[t]})}(n);var l=s(583),o=s(14),u=a,c=o(r.a,l.a,!1,u,null,null);e.default=c.exports},483:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=s(10),r=a(i),n=s(19),l=s(85),o=a(l),u=s(575),c=a(u),d=s(579),m=a(d);e.default={name:"user-alboms",metaInfo:function(){return{title:"Альбомы"}},asyncData:function(t){var e=t.store,s=t.route;return e.dispatch("albums/getAlbums",{user_id:s.params.id})},components:{ModalLayout:o.default,AddAlbum:m.default,AlbumList:c.default},computed:(0,r.default)({},(0,n.mapState)("profile",["user_profile"]),(0,n.mapState)("user",["user"]),(0,n.mapState)("albums",["albums","addAlbum"])),methods:(0,r.default)({},(0,n.mapMutations)("albums",["CHANGE_ADD_ALBUM_MODAL"]))}},484:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:["link","item"]}},485:function(t,e,s){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=s(15),r=a(i),n=s(16),l=a(n),o=s(10),u=a(o),c=s(19),d=s(85),m=a(d),p=s(20),f=a(p);e.default={components:{ModalLayout:m.default},data:function(){return{title:"",previews:[],resp:{status:null,mess:""},percent:0,loading:!1}},computed:(0,u.default)({},(0,c.mapState)("user",["user"]),(0,c.mapState)("albums",["addAlbum"])),watch:{previews:function(){this.resp.status=null,this.resp.mess=""}},methods:(0,u.default)({},(0,c.mapMutations)("albums",["CHANGE_ADD_ALBUM_MODAL"]),{close:function(){this.loading=!1,this.percent=0,this.title="",this.previews=[],this.resp={status:null,mess:""},this.CHANGE_ADD_ALBUM_MODAL({bg:!1,modal:!1})},checkCover:function(t){this.previews.map(function(e,s){e.check=!1,s==t&&(e.check=!0)})},deletePreview:function(t){this.previews.splice(t,1)},changeUpload:function(t){var e=this,s=t.target.files;if(this.previews.length+s.length>8)return this.resp.status=!1,this.resp.mess="Не более 8 фотографий",!1;for(var a=0;a<s.length;a++)!function(t){var a=s[t],i=(new Image,e),r=new FileReader;r.onload=function(t){return function(t){var e=t.target.result;i.previews.push({file:a,src:e,check:!1})}}(),r.readAsDataURL(a)}(a)},send:function(){var t=this;return(0,l.default)(r.default.mark(function e(){var s,a,i,n;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.resp={status:null,mess:""},0!=t.previews.length){e.next=5;break}return t.resp.status=!1,t.resp.mess="Вы не выбрали фотографии",e.abrupt("return",!1);case 5:if(s=!1,t.previews.map(function(t){t.check&&(s=!0)}),s){e.next=11;break}return t.resp.status=!1,t.resp.mess="Вы не выбрали обложку",e.abrupt("return",!1);case 11:return a=new FormData,a.append("title",t.title),a.append("length",t.previews.length),t.previews.map(function(t,e){t.check?a.append("img_cover",t.file):a.append("img"+e,t.file)}),e.prev=15,t.loading=!0,e.next=19,f.default.post("/api/v1/user-albums",a,{headers:{Authorization:"Bearer "+t.user.token},params:{user_id:t.user.user_id},onUploadProgress:function(t){var e=parseInt(Math.round(100*t.loaded/t.total));return this.onProgress(e),e}.bind(t)});case 19:i=e.sent,t.resp.status=i.data.success,t.resp.mess=i.data.message,t.$store.dispatch("albums/getAlbums",{user_id:t.$route.params.id}),t.$store.dispatch("photos/getPhotosMain",{user_id:t.$route.params.id}),setTimeout(function(){t.close()},2e3),e.next=31;break;case 27:e.prev=27,e.t0=e.catch(15),n=e.t0.response,n&&(t.resp.status=!1,t.resp.mess=n.data.message);case 31:case"end":return e.stop()}},e,t,[[15,27]])}))()},onProgress:function(t){this.percent=t}})}},573:function(t,e,s){var a=s(574);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);s(443)("46e7eefe",a,!0,{})},574:function(t,e,s){e=t.exports=s(442)(!1),e.push([t.i,".albums-page{max-width:940px;min-width:940px}",""])},575:function(t,e,s){"use strict";function a(t){s(576)}Object.defineProperty(e,"__esModule",{value:!0});var i=s(484),r=s.n(i);for(var n in i)"default"!==n&&function(t){s.d(e,t,function(){return i[t]})}(n);var l=s(578),o=s(14),u=a,c=o(r.a,l.a,!1,u,null,null);e.default=c.exports},576:function(t,e,s){var a=s(577);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);s(443)("68196dfe",a,!0,{})},577:function(t,e,s){e=t.exports=s(442)(!1),e.push([t.i,"",""])},578:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("router-link",{staticClass:"itemCard",attrs:{to:""+t.link}},[s("div",{staticClass:"itemCard-image"},[s("img",{staticClass:"img",attrs:{src:"/api/"+t.item.user_photo.src+"/cover_"+t.item.user_photo.image}})]),s("div",{staticClass:"itemCard-body"},[s("div",{staticClass:"itemCard-body__text"},[t._v("\n      "+t._s(t.item.title)+"\n    ")])])])},i=[],r={render:a,staticRenderFns:i};e.a=r},579:function(t,e,s){"use strict";function a(t){s(580)}Object.defineProperty(e,"__esModule",{value:!0});var i=s(485),r=s.n(i);for(var n in i)"default"!==n&&function(t){s.d(e,t,function(){return i[t]})}(n);var l=s(582),o=s(14),u=a,c=o(r.a,l.a,!1,u,null,null);e.default=c.exports},580:function(t,e,s){var a=s(581);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);s(443)("46adb0ce",a,!0,{})},581:function(t,e,s){e=t.exports=s(442)(!1),e.push([t.i,".add-album{max-width:570px;min-width:570px}",""])},582:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("modal-layout",{attrs:{bgShow:t.addAlbum.bg,modalShow:t.addAlbum.modal},on:{close:function(e){return t.close()}}},[s("div",{staticClass:"modalBlock add-album"},[s("div",{staticClass:"modalBlock-title"},[t._v("\n      Добавление альбома\n    ")]),t.loading?s("div",{staticClass:"modalBlock-body"},[s("div",{staticClass:"modalBlock-body__loading"},[s("div",{staticClass:"modalBlock-body__loading-bar"},[s("div",{staticClass:"modalBlock-body__loading-bar__bg",style:"width: "+t.percent+"%"})]),s("div",{staticClass:"modalBlock-body__loading-text"},[null==t.resp.status?s("span",[t._v("\n            Дождитесь загрузки\n          ")]):s("span",{staticClass:"res-mess",class:1==t.resp.status?"success":"error"},[t._v("\n            "+t._s(t.resp.mess)+"\n          ")])])])]):s("div",[s("div",{staticClass:"modalBlock-form normal-form"},[s("div",{staticClass:"modalBlock-form__line"},[s("label",{staticClass:"label",attrs:{for:"title"}},[t._v("\n            Заголовок\n          ")]),s("div",{staticClass:"modalBlock-form__line-input"},[s("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:t.title,expression:"title",modifiers:{trim:!0}}],staticClass:"textarea",attrs:{col:"2"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])]),s("div",{staticClass:"modalBlock-form__line"},[s("label",{staticClass:"label"},[t._v("\n            Загрузка фотографий\n          ")]),s("div",{staticClass:"modalBlock-form__line-input"},[s("label",{staticClass:"btn addNew",attrs:{for:"uploadPhoto"}},[s("input",{attrs:{type:"file",id:"uploadPhoto",multiple:"",accept:".jpg, .jpeg, .png"},on:{change:t.changeUpload}}),t._v("\n              Зарузить фото\n            ")])])]),t.previews.length>0?s("div",{staticClass:"modalBlock-form__line"},[s("label",{staticClass:"label"},[t._v("\n            Фотографии\n          ")]),s("div",{staticClass:"modalBlock-form__line-imglist"},t._l(t.previews,function(e,a){return s("div",{key:a,staticClass:"modalBlock-form__line-imglist__item"},[s("a",{staticClass:"delete",attrs:{href:"/delete"},on:{click:function(e){return e.preventDefault(),t.deletePreview(a)}}},[s("img",{attrs:{src:"/img/icons/closedel.png"}})]),s("label",{attrs:{for:"item_"+a}},[s("div",{staticClass:"modalBlock-form__line-imglist__item-img",style:"background-image: url("+e.src+")"}),s("div",{staticClass:"modalBlock-form__line-imglist__item-block"},[s("input",{attrs:{type:"radio",id:"item_"+a,name:"inputRadio"},domProps:{checked:!!e.check},on:{click:function(e){return t.checkCover(a)}}}),s("span",{staticClass:"cover"},[t._v("\n                    Обложка\n                  ")])])])])}),0)]):t._e()]),s("div",{staticClass:"modalBlock-btn twoBtns"},[s("button",{staticClass:"btn addNew",on:{click:function(e){return t.close()}}},[t._v("\n          Отменить\n        ")]),s("button",{staticClass:"btn send",on:{click:function(e){return t.send()}}},[t._v("\n          Сохранить\n        ")]),null!=t.resp.status?s("span",{staticClass:"res-mess",class:1==t.resp.status?"success":"error"},[t._v("\n          "+t._s(t.resp.mess)+"\n        ")]):t._e()])])])])},i=[],r={render:a,staticRenderFns:i};e.a=r},583:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.addAlbum.modal?t._e():s("modal-layout",{attrs:{bgShow:!0,modalShow:!0},on:{close:function(e){return t.$router.push("/user/"+t.$route.params.id)}}},[s("div",{staticClass:"modalBlock albums-page"},[s("div",{staticClass:"modalBlock-title"},[t._v("\n        Фотоальбомы\n      ")]),s("div",{staticClass:"modalBlock-cards"},[t.user_profile.id==t.user.user_id?s("a",{staticClass:"itemCard addCard",attrs:{href:"/add"},on:{click:function(e){return e.preventDefault(),t.CHANGE_ADD_ALBUM_MODAL({bg:!0,modal:!0})}}},[s("div",{staticClass:"addBtn"},[s("img",{attrs:{src:"/img/icons/bigplus.png"}})]),s("div",{staticClass:"addText"},[t._v("\n            Добавить альбом\n          ")])]):t._e(),t._l(t.albums,function(e,a){return s("album-list",{key:a,attrs:{item:e,link:t.$route.path+"/"+e.id}})})],2)])]),t.user_profile.id==t.user.user_id?s("add-album"):t._e()],1)},i=[],r={render:a,staticRenderFns:i};e.a=r}});